<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Threat Loom{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='img/icon.jpg') }}">
</head>
<body>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-brand">
                <img src="{{ url_for('static', filename='img/icon.jpg') }}" alt="Threat Loom" class="brand-logo">
                <div class="brand-text">
                    <h1>Threat Loom</h1>
                    <p class="brand-tagline">AI-powered threat news analysis platform</p>
                </div>
            </div>
            <nav class="sidebar-nav">
                <a href="/" class="nav-item {% if request.path == '/' %}active{% endif %}">
                    <span class="nav-icon">&#9881;</span>
                    <span>Feed</span>
                </a>
                <a href="/intelligence" class="nav-item {% if request.path == '/intelligence' %}active{% endif %}">
                    <span class="nav-icon">&#128270;</span>
                    <span>Intelligence</span>
                </a>
                <a href="/settings" class="nav-item {% if request.path == '/settings' %}active{% endif %}">
                    <span class="nav-icon">&#9881;</span>
                    <span>Settings</span>
                </a>
            </nav>
            <div class="sidebar-stats" id="sidebar-stats">
                <div class="stat-item">
                    <span class="stat-value" id="stat-articles">--</span>
                    <span class="stat-label">Articles</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-sources">--</span>
                    <span class="stat-label">Sources</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-summaries">--</span>
                    <span class="stat-label">Summaries</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-unsummarized">--</span>
                    <span class="stat-label">Unsummarized</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-scrape-failed">--</span>
                    <span class="stat-label">Scrape Failed</span>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <div class="search-wrapper">
                    <input type="text" id="search-input" class="search-input" placeholder="Search articles...">
                </div>
                <div class="top-bar-actions">
                    <span class="refresh-status" id="refresh-status"></span>
                    <div class="refresh-controls">
                        <input type="number" id="refresh-days" class="days-input" value="1" min="1" max="30" title="Days to look back">
                        <span class="days-label">days</span>
                        <button class="btn btn-primary" id="refresh-btn" onclick="triggerRefresh()">
                            <span class="btn-icon">&#8635;</span> Refresh
                        </button>
                        <button class="btn btn-primary refresh-since-btn" onclick="refreshSinceLastRetrieval()">
                            <span class="btn-icon">&#8635;</span> Since Last Retrieval
                        </button>
                    </div>
                </div>
            </header>

            <div class="content-area">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>

    <!-- Disclaimer Modal (shown once per session on home page) -->
    <div class="modal-overlay" id="disclaimer-modal" style="display:none">
        <div class="modal-dialog">
            <h3 class="modal-title">Disclaimer</h3>
            <p class="modal-body">This application was fully generated by Claude Code (Anthropic). It is provided strictly for educational and informational purposes. Any use of this application for malicious purposes is expressly prohibited and may violate applicable laws. The author is not responsible for any misuse of this application. The author provides this application "AS-IS" without warranty of any kind, express or implied, and shall not be liable for any damages or consequences resulting from its use.</p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="dismissDisclaimer()">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Cost Estimate Confirmation Modal -->
    <div class="modal-overlay" id="cost-estimate-modal" style="display:none">
        <div class="modal-dialog">
            <h3 class="modal-title">Summarization Cost Estimate</h3>
            <p class="modal-body" id="cost-estimate-body"></p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="approveCost()">Proceed</button>
                <button class="btn btn-secondary" onclick="declineCost()">Skip</button>
            </div>
        </div>
    </div>

    <!-- Insight Cost Estimate Modal (Trend Analysis / Forecast) -->
    <div class="modal-overlay" id="insight-estimate-modal" style="display:none">
        <div class="modal-dialog">
            <h3 class="modal-title" id="insight-estimate-title">Cost Estimate</h3>
            <p class="modal-body" id="insight-estimate-body"></p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="insightProceed()">Proceed</button>
                <button class="btn btn-secondary" onclick="insightCancel()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Insight Actual Cost Modal (shown after Trend Analysis / Forecast) -->
    <div class="modal-overlay" id="insight-actual-modal" style="display:none">
        <div class="modal-dialog">
            <h3 class="modal-title" id="insight-actual-title">Generation Complete</h3>
            <p class="modal-body" id="insight-actual-body"></p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="dismissInsightActual()">OK</button>
            </div>
        </div>
    </div>

    <!-- Actual Cost Result Modal -->
    <div class="modal-overlay" id="actual-cost-modal" style="display:none">
        <div class="modal-dialog">
            <h3 class="modal-title">Summarization Complete</h3>
            <p class="modal-body" id="actual-cost-body"></p>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="dismissActualCost()">OK</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
